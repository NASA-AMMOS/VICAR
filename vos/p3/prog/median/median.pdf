process help=*
PARM INP	TYPE = (STRING,60)
PARM OUT	TYPE = (STRING,60)		              DEFAULT = MEDIAN
PARM SIZE	TYPE = INTEGER 	COUNT=0:4    	              DEFAULT=--
PARM SL         TYPE = INTEGER  COUNT=0:1                     DEFAULT=--
PARM SS         TYPE = INTEGER  COUNT=0:1                     DEFAULT=--
PARM NL		TYPE = INTEGER  COUNT=0:1		      DEFAULT=--
PARM NS         TYPE = INTEGER  COUNT=0:1		      DEFAULT=--
PARM NLW        TYPE = INTEGER			              DEFAULT = 11
PARM NSW        TYPE = INTEGER		 	              DEFAULT = 11
PARM HIGHPASS	TYPE = KEYWORD  VALID ="HIGHPASS" COUNT=(0:1) DEFAULT =--
PARM DCLEVEL	TYPE = REAL			              DEFAULT = 128.0
PARM DCTRAN     TYPE = REAL			              DEFAULT = 0.0
PARM PERCENT	TYPE = REAL			              DEFAULT = 50.0
END-PROC
.TITLE
VICAR1 program MEDIAN: Performs spatial median filtering of an image.
.HELP
PURPOSE:

MEDIAN is a VICAR applications program which performs nonlinear spatial
filtering of an image based upon the local (rectangular window) median or
percentile rank of the input. Output may be in either lowpass or highpass form.

.PAGE
EXECUTION:

MEDIAN may be executed in the following manner:

		MEDIAN INP=A OUT=B SIZE=(SL,SS,NL,NS) PARAMS

where INP, OUT, SIZE, AND PARAMS are parameters and are explained in their
respective parameter section.

.PAGE
OPERATION:

MEDIAN finds the local median value of a rectangular window centered at
each pixel by accumulating  a histogram of all contained pixels. This
histogram could be interrogated for three basic statistical quantities:
mean, mode, and median. The mean is the average value in the histogram, the
mode is the most frequently occurring value in the histogram, and the median
is the value which equally divides the population of the histogram. 

The output value of MEDIAN may be modified by the inclusion of the PERCENT
keyword.  For example, PERCENT=25.0 will output the value which has 25% of 
the window pixels less than it, and 75% of the window pixels greater than it.

If HIGHPASS is specified, the final output is given as:

		OUT = IN - MEDIAN + DCLEVEL + DCTRAN*IN

.PAGE
BIBLIOGRAPHY:

Huang, Yang, and Tang, "A Fast Two-Dimensional Median Filtering Algorithm,"
	IEEE Trans., Vol. ASSP-27, No. 1, February 1979.
.PAGE
EXAMPLES:

	1) MEDIAN INP=A OUT=B NLW=5 NSW=7

		This example performs the lowpass median filter of size 5 lines
		by 7 samples.

	2) MEDIAN INP=A OUT=B 'HIGH NLW=3 NSW=3

		This example performs the highpass median filter of size
		3x3 pixels.

	3) MEDIAN INP=A OUT=B PERCENT=20 NLW=7 NSW=9

		This example outputs a value corresponding to the 20% level
 		of a histogram generated by a 7 line by 9 sample filter. The
		output is then the 12th lowest value in the local window
		rather than the 31st lowest value (50% level).
.PAGE
HISTORY:

ORIGINALLY WRITTEN BY: W. D. Benton, 27 November 1978
REWRITTEN WITH FASTER ALGORITHM BY:  H. J. Frieden,  22 July 1980
CONVERTED TO VAX BY:  Helen De Rueda,  30 Nov. 1983
REWRITTEN TO PERMIT NON-BYTE DATA: Ron Alley, 4 Dec 1991
COGNIZANT PROGRAMMER:  Ron Alley
.LEVEL1
.VARI INP
input dataset.
.VARI OUT
output dataset.
.VARI SIZE
VICAR size field,
(SL,SS,NL,NS).
.VARI SL
starting line to be output
.VARI SS
first sample to be output
.VARI NL
number of lines
.VARI NS
Number of samples
.VARI NLW
Size of filter in lines
.VARI NSW
Size of filter in samples
.VARI HIGHPASS
KEYWORD-Highpass option.
.VARI DCLEVEL
Offset to be added to
highpass output.
.VARI PERCENT
Output value percentile
.VARI DCTRAN
DCTRAN*Local Median is
added to the highpass output.
.LEVEL2
.VARI INP
STRING - INP=A where A is the input dataset name.
.VARI OUT
STRING - OUT=B where B is the output dataset name.
.VARI SIZE
4 INTEGERS - SIZE=(SL,SS,NL,NS) where SL is the starting line, SS is the
 starting sample, NL is the number of lines output and NS is the number of 
 samples output. (SIZE is usually defined as SIZE=(1,1,NL,NS)). Default is 
 taken from the VICAR label within the program.
.VARI NL
INTEGER - NL=N1 where is N1 is the number of lines output.
.VARI NS
INTEGER - NS=N1 where is N1 is the number of samples output.
.VARI NLW
INTEGER - NLW=I1 where I1 is an integer and specifies the size of the filter
 kernel in lines. NLW should be an odd integer; if it is not, the program
 uses the next larger odd integer.  Default is NLW=11. 
.VARI NSW
INTEGER - NSW=I2 where I2 is an integer and specifies the size of the filter
 kernel in samples. NSW should be an odd integer; if it is not, the program
 uses the next larger odd integer.  Default is NSW=11.
.VARI HIGHPASS
KEYWORD - Valid:('HIGH) 'HIGHPASS specifies that the output is to be in
 highpass format, i.e., the input minus the local median value. Default
 is the lowpass mode.
.VARI DCLEVEL
DCLEVEL is a constant added to all pixels prior to output, when in the 
HIGHPASS mode.  It is most commonly used to rescale byte data back into
the 0 to 255 range.
.VARI PERCENT
REAL - PERCENT=R4 where R4 is an floating point number and specifies the
 percentage of the filter window values which are less than or equal to the
 output value.  The default of PERCENT=50.0 specifies that the true median 
 value of filter window is to be found, whereas if a lower (or higher)
 value is specified, the output value will be somewhat lower (or higher)
 than the actual median.
.VARI DCTRAN
DCTRAN is a scaling factor, used in the HIGHPASS mode, when the user desires
to add back part of the input image to the output. In the HIGHPASS mode

      OUTPUT  =   INPUT - MEDIAN + (DCTRAN*INPUT) + DCLEVEL
.END
