process help=*
PARM INP	TYPE=STRING  COUNT=1
PARM OUT	TYPE=STRING  COUNT=1				DEFAULT=MEDIAN
PARM SIZE	TYPE=INTEGER COUNT=0:4				DEFAULT=--
PARM NL		TYPE=INTEGER COUNT=0:1				DEFAULT=--
PARM NS         TYPE=INTEGER COUNT=0:1				DEFAULT=--
PARM NLW        TYPE=INTEGER VALID=(1:999)			DEFAULT=11
PARM NSW        TYPE=INTEGER VALID=(1:999)			DEFAULT=11
PARM HIGHPASS	TYPE=KEYWORD VALID=HIGHPASS COUNT=(0:1)		DEFAULT =--
PARM DCLEVEL	TYPE=INTEGER COUNT=0:1 VALID=(0:32767)		DEFAULT=128
PARM PERCENT	TYPE=REAL    VALID=(0.:100.)			DEFAULT=50.0
PARM DCTRAN     TYPE=REAL    COUNT=0:1 VALID=(0.:1.)		DEFAULT=0.0
END-PROC
.TITLE
VICAR1 program MEDIAN: Spatial median filter
.HELP
PURPOSE:

MEDIAN is a VICAR applications program which performs nonlinear
spatial filtering of an image based upon the local (rectangular
window) median of the input. Output may be in either lowpass or
highpass form. Zero valued DN are optionally ignored.

.PAGE
EXECUTION:

	median inp=ipic out=opic
where
  ipic is the input image
  opic is the output image

ipic may be in byte, halfword, or real data format.  opic is output in
the same format.  The input image must be at least 2 lines and 2
samples in size.  There is no upper limit for the image size. The
input may be multi-band. All bands are processed sequentially.

Reference:
  Huang, Yang, and Tang, "A Fast Two-Dimensional Median Filtering Algorithm,"
	IEEE Trans., Vol. ASSP-27, No. 1, February 1979.

.PAGE
OPERATION:

MEDIAN replaces each input pixel by the local median value of an NLW X NSW
window centered at that pixel (see NLW and NSW parameters).

The median is defined as the DN value for which half of the pixels in the
window have a lower value and half have a higher value.  That is, if the
pixels in the window were sorted by DN value, then the median would be the
DN of the pixel exactly half way in the sorted list.  The sorting is performed
by accumulating a histogram of the window (see referenced paper).

The output value can be more generally defined using the PERCENT parameter.
If PERCENT=P, then the output value is that DN for which P*NLW*NSW/100 pixels
in the window have a higher value.  For example, if PERCENT=50 (the default),
then the output is the median.

The effect of replacing each pixel by the local median is to remove all high
frequency scene information.  Thus the median filter functions like a low
pass filter.  See also program BOXFLT2.

If HIGHPASS is specified, the final output is given as:

		OUT = IN - MEDIAN + DCLEVEL
where
	DCLEVEL is an integer value (see DCLEVEL parameter).

The effect of the HIGHPASS keyword is to convert the program into a high pass
filter.

.PAGE
EXAMPLES:

	1) MEDIAN INP=A OUT=B NLW=5 NSW=7

		This example performs the lowpass median filter of size 5 lines
		by 7 samples.

	2) MEDIAN INP=A OUT=B 'HIGH NLW=3 NSW=3

		This example performs the highpass median filter of size
		3x3 pixels.

	3) MEDIAN INP=A OUT=B PERCENT=20 NLW=7 NSW=9

		This example outputs a value corresponding to the 20% level
 		of a histogram generated by a 7 line by 9 sample filter. The
		output is then the 12th lowest value in the local window
		rather than the 31st lowest value (50% level).


.PAGE
HISTORY:

ORIGINALLY WRITTEN BY: W. D. Benton, 27 November 1978
REWRITTEN WITH FASTER ALGORITHM BY:  H. J. Frieden,  22 July 1980
CONVERTED TO VAX BY:  Helen De Rueda,  30 Nov. 1983
COGNIZANT PROGRAMMER:  Jean Lorre

Revisions:
 2005-08-18 G Yagi  Fix DCLEVEL parameter on Linux.
 2016-12-02 W Bunch Added support for real data and multi-band input.

.LEVEL1
.VARI INP
Required string
Input image
.VARI OUT
Required string
Output image
.VARI SIZE
Optional 4 integers
VICAR size field,
SIZE=(SL,SS,NL,NS)
.VARI NL
Optional integer
number of output lines
.VARI NS
Optional integer
number of output samples
output file.
.VARI NLW
Optional integer
filter kernel height (lines)
.VARI NSW
filter kernel width (samples)
.VARI HIGHPASS
Optional keyword
output highpass image
.VARI DCLEVEL
Optional integer
DN offset added to output
.VARI PERCENT
Optional REAL
percent of data greater than
output (=50 for median)
.VARI DCTRAN
Optional REAL
DCTRAN*Local Median is
added to the highpass output.

.LEVEL2
.VARI INP
  INP=ipic
where ipic is the input image.  ipic may be in byte, halfword, or real
data format.  ipic must be at least 2 lines and 2 samples in size.
ipic may be arbitrarily large.  The input may be multi-band. All bands
are processed sequentially.

.VARI OUT
  OUT=opic
where opic is the output image.  opic will have the same data format as the
input image.

.VARI SIZE
4 INTEGERS - SIZE=(SL,SS,NL,NS) where SL is the starting line, SS is the
 starting sample, NL is the number of lines in the input dataset and NS
 is the number of samples in the input dataset. (SIZE is usually defined
 as SIZE=(1,1,NL,NS)). Default is taken from the VICAR label within the
 program.
.VARI NL
INTEGER - NL=N1 where is N1 is the number of lines in the input dataset.
.VARI NS
INTEGER - NS=N1 where is N1 is the number of samples in the input dataset.
.VARI NLW
INTEGER - NLW=I1 where I1 is an integer and specifies the size of the filter
 kernel in lines. Default is NLW=11.
.VARI NSW
INTEGER - NSW=I2 where I2 is an integer and specifies the size of the filter
 kernel in samples. Default is NSW=11.
.VARI HIGHPASS
KEYWORD - Valid:('HIGH) 'HIGHPASS specifies that the output is to be in
 highpass format, i.e., the input minus the local median value. Default
 is the lowpass mode.
.VARI DCLEVEL
INTEGER - DCLEVEL=I3 where I3 is an integer and
 specifies the offset to be added to the highpass output. Default is
 DCLEVEL=128.
.VARI PERCENT
REAL - PERCENT=R4 where R4 is an floating point number and specifies the
 percentage of the window size which must be satisfied for an output value
 to be found at each point. The default of PERCENT=50.0 specifies that the
 true median value of window is to be found, whereas if a lower (or higher)
 value is specified, the output value will be somewhat lower (or higher)
 than the actual median.
.VARI DCTRAN
REAL - DCTRAN=R where R is a number such that 0.0<=R<=1.0. 
DCTRAN * output(local median value) is added to the highpass output.
Default is DCTRAN=0.0

.END
